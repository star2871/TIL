# âœï¸ ëŒ€ëŒ“ê¸€ ë‹¬ê¸°
## ë¡œê·¸ì¸ ë°ì½”ë ˆì´í„°ë¥¼ ì‚¬ìš©í•´ì„œ ë¡œê·¸ì¸ëœ ê¶Œí•œìžˆëŠ” ìœ ì €ë§Œì´ ëŒ€ëŒ“ê¸€ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìžˆë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.

# âš½ ëŒ€ëŒ“ê¸€ ê¸°ëŠ¥ ë¶„ì„
## í•˜ë‚˜ì˜ ëŒ“ê¸€ì— ëŒ€í•´ ì—¬ëŸ¬ ê°œì˜ ëŒ€ëŒ“ê¸€ì´ ë‹¬ë¦´ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.(1:N)

# ðŸ‘Œ App
## ëŒ€ëŒ“ê¸€ ê¸°ëŠ¥ì€ ê²Œì‹œë¬¼ê³¼ ê´€ë ¨ë˜ì–´ ìžˆìœ¼ë¯€ë¡œ `reviews` ì•±ì—ì„œ ìž‘ì„±í•©ë‹ˆë‹¤.

# ðŸ’Ž Model ìž‘ì„±
```
class Comment(models.Model):
    content        = models.CharField(max_length=500)
    created_at     = models.DateTimeField(auto_now_add=True)
    user           = models.ForeignKey('user.User', on_delete=models.CASCADE)
    review        = models.ForeignKey('Review', on_delete=models.CASCADE)
    parent_comment = models.ForeignKey('self', on_delete=models.CASCADE, null=True)  --> ì¶”ê°€

    class Meta:
        db_table = 'comments'
```

## Q. ëŒ€ëŒ“ê¸€ì„ ìœ„í•œ í…Œì´ë¸”ì„ ìƒì„±í•˜ì§€ ì•Šê³  comment í…Œì´ë¸”ì„ ì‚¬ìš©í•˜ëŠ” ì´ìœ ëŠ”?
## ëŒ€ëŒ“ê¸€ì´ëž€ ë‹¤ë¥¸ ëŒ“ê¸€ì— ë‹¬ë¦° ëŒ“ê¸€ìœ¼ë¡œ ê·¸ ë³¸ì§ˆì€ ëŒ“ê¸€ì´ê¸° ë•Œë¬¸ìž…ë‹ˆë‹¤. ëŒ€ì‹  ê·¸ëƒ¥ ëŒ“ê¸€ê³¼ ëŒ€ëŒ“ê¸€ì„ êµ¬ë¶„í•´ì£¼ê¸° ìœ„í•´ `parent_comment` í•„ë“œë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤. ì´ í•„ë“œì— ê°’ì´ ìžˆìœ¼ë©´ ëŒ€ëŒ“ê¸€ì´ê³ , ì•„ë‹ˆë©´ ê·¸ëƒ¥ ëŒ“ê¸€ìž…ë‹ˆë‹¤.

## Q. 'self'ëŠ” ìžê¸° ìžì‹ ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. í•˜ë‚˜ì˜ ëŒ“ê¸€ì— ëŒ€í•´ ì—¬ëŸ¬ ê°œì˜ ëŒ€ëŒ“ê¸€ì´ ë‹¬ë¦´ ìˆ˜ ìžˆìœ¼ë¯€ë¡œ, 1:Nì˜ ê´€ê³„ìž…ë‹ˆë‹¤. ë”°ë¼ì„œ `ForeignKey`ë¡œ ìžì‹ ì´ ì†í•œ `Comment í´ëž˜ìŠ¤`ë¥¼ ì°¸ì¡°í•©ë‹ˆë‹¤.ëŒ€ëŒ“ê¸€ì´ ì•„ë‹Œ ê²½ìš° `parent_comment`ê°€ ì—†ì„ ìˆ˜ë„ ìžˆìœ¼ë¯€ë¡œ `null=True`ë¥¼ ì§€ì •í–ˆìŠµë‹ˆë‹¤.

# âž¡ï¸ View ìž‘ì„±
## CommentViewì˜ postí•¨ìˆ˜ì— ëŒ€ëŒ“ê¸€ ê¸°ëŠ¥ ì¶”ê°€
### ì´ë¯¸ ëŒ“ê¸€ ë“±ë¡ ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê¸° ìœ„í•´ CommentViewì˜ review í•¨ìˆ˜ë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤. ì´ í•¨ìˆ˜ì—ì„œ ëŒ€ëŒ“ê¸€ì„ ìƒì„±í•  ìˆ˜ ìžˆëŠ” ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ë„ë¡ í•©ì‹œë‹¤. ë‹¨ìˆœížˆ `parent_comment` ì •ë³´ë¥¼ í•¨ê»˜ ìƒì„±í•  ìˆ˜ ìžˆê²Œ í•˜ë©´ ë©ë‹ˆë‹¤.

### `parent_comment_id = data.get('parent_comment_id', None)`ë¡œ ë¶€ëª¨ëŒ“ê¸€ ì •ë³´ë¥¼ ë°›ìŠµë‹ˆë‹¤. ì´ ì •ë³´ëŠ” í•„ìˆ˜ê°€ ì•„ë‹ˆë¯€ë¡œ ì „ë‹¬ë˜ì§€ ì•Šì„ ê²½ìš° `None`ì´ í• ë‹¹ë˜ë„ë¡ í•˜ì˜€ê³ , `KeyError` ì²˜ë¦¬ë„ í•´ì£¼ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
```
content           = data.get('content', None)
review_id        = data.get('review_id', None)
parent_comment_id = data.get('parent_comment_id', None)  --> ì¶”ê°€

if not (content and review_id):
    return JsonResponse({'message':'KEY_ERROR'}, status=400)
```

### ëŒ“ê¸€ ì •ë³´ë¥¼ ìƒì„±í•  ë•Œë„ `parent_comment_id`ê°€ í•¨ê»˜ ìƒì„±ë˜ë„ë¡ í•©ë‹ˆë‹¤. (ëŒ€ëŒ“ê¸€ì´ ì•„ë‹ ê²½ìš°ì—ëŠ” `None`ì´ ìž…ë ¥ë  ê²ƒìž…ë‹ˆë‹¤.)
```
Comment.objects.create(
    content           = content,
    user              = user,
    review           = review,
    parent_comment_id = parent_comment_id  --> ì¶”ê°€
)
```

# ðŸ˜Ž ì „ì²´ view ì½”ë“œ
```
class CommentView(View):
    @login_decorator
    def post(self, request):
        try:
            data = json.loads(request.body)
            user = request.user

            content           = data.get('content', None)
            review_id        = data.get('review_id', None)
            parent_comment_id = data.get('parent_comment_id', None)

            if not (content and review_id):
                return JsonResponse({'message':'KEY_ERROR'}, status=400)

            if not Posting.objects.filter(id=review_id).exists():
                return JsonResponse({'message':'POSTING_DOES_NOT_EXIST'}, status=404)
            
            review = Posting.objects.get(id=review_id)

            Comment.objects.create(
                content           = content,
                user              = user,
                review           = review,
                parent_comment_id = parent_comment_id
            )

            return JsonResponse({'message':'SUCCESS'}, status=201)
        
        except JSONDecodeError:
            return JsonResponse({'message':'JSON_DECODE_ERROR'}, status=400)
```