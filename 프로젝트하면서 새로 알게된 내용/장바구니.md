1. ì¿ í‚¤
ì¿ í‚¤ë€? í´ë¼ì´ì–¸íŠ¸ì˜ ë¡œì»¬ì— ì €ì¥ë˜ëŠ” key-value ìŒìœ¼ë¡œ ì´ë£¨ì–´ì§„ ì‘ì€ ë°ì´í„° íŒŒì¼ì´ë‹¤.
ì¿ í‚¤ê°€ í•˜ëŠ” ì¼?
ì„¸ì…˜ ê´€ë¦¬: ë¡œê·¸ì¸, ì•„ì´ë”” ìë™ì™„ì„±, ê³µì§€ í•˜ë£¨ ì•ˆë³´ê¸°, ì¥ë°”êµ¬ë‹ˆ
ê°œì¸í™”: ì‚¬ìš©ì í…Œë§ˆ
íŠ¸ë˜í‚¹: ì‚¬ìš©ì í–‰ë™ ê¸°ë¡ ë° ë¶„ì„
ë™ì¼í•œ ì„œë²„ì— ì¬ìš”ì²­ì‹œ ì €ì¥ëœ ì¿ í‚¤ğŸªë¥¼ í•¨ê»˜ ë³´ë‚¸ë‹¤.

ë™ì‘ ë°©ì‹ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

1)  í´ë¼ì´ì–¸íŠ¸ê°€ ì„œë²„ë¡œ ë¡œê·¸ì¸ì„ ìš”ì²­í•œë‹¤. (GET)

2) ì„œë²„ëŠ” í´ë¼ì´ì–¸íŠ¸ì˜ ë¡œê·¸ì¸ ìš”ì²­ì˜ ìœ íš¨ì„±ì„ í™•ì¸í•˜ê³  ì‘ë‹µí—¤ë”ì— Set-Cookie: session-id=12345; ë¥¼ ì¶”ê°€í•˜ì—¬ ì‘ë‹µí•œë‹¤. 

3) í´ë¼ì´ì–¸íŠ¸ëŠ” ì´í›„ ì„œë²„ì— ìš”ì²­í•  ë•Œ Cookie: session-id-12345; ì¿ í‚¤ğŸªë¥¼  headerì— ì¶”ê°€í•˜ì—¬ ìš”ì²­í•œë‹¤. ì´ ì‘ì—…ì€ ë¸Œë¼ìš°ì €ê°€ í•œë‹¤. 


```## cart/urls.py
from django.urls import path
from .views import *

app_name = "cart"

urlpatterns = [
    path("", cart_detail, name="cart_detail"),
    path("add/<int:product_id>", cart_add, name="cart_add"),
    path("remove/<int:product_id>", cart_remove, name="cart_remove"),
]

```## cart/views.py
from django.shortcuts import render, redirect, get_object_or_404
from django.views.decorators.http import require_POST
from products.models import Product, Image
from .cart import Cart
from .forms import CartAddProductForm


@require_POST
def cart_add(request, product_id):
    cart = Cart(request)
    product = get_object_or_404(Product, id=product_id)
    form = CartAddProductForm(request.POST)
    if form.is_valid():
        cd = form.cleaned_data
        cart.add(product=product, quantity=cd["quantity"], update_quantity=cd["update"])
    return redirect("cart:cart_detail")


def cart_remove(request, product_id):
    cart = Cart(request)
    product = get_object_or_404(Product, id=product_id)
    cart.remove(product)
    return redirect("cart:cart_detail")


def cart_detail(request):
    images = []
    cart = Cart(request)
    for item in cart:
        item["update_quantity_form"] = CartAddProductForm(
            initial={"quantity": item["quantity"], "update": True}
        )
        images.append(Image.objects.filter(product_id=item["product"].id)[0])

    context = {
        "cart": cart,
        "images": images,
    }
    return render(request, "cart/detail.html", context)

```

```## cart/cart.py ì¿ í‚¤ì²˜ë¦¬í•˜ëŠ” ë¶€ë¶„
from decimal import Decimal
from django.conf import settings
from products.models import Product


class Cart(object):
    def __init__(self, request):
        self.session = request.session
        cart = self.session.get(settings.CART_SESSION_ID)
        if not cart:
            cart = self.session[settings.CART_SESSION_ID] = {}
        self.cart = cart

    def add(self, product, quantity=1, update_quantity=False):
        product_id = str(product.id)
        if product_id not in self.cart:
            self.cart[product_id] = {"quantity": 0, "price": str(product.price)}
        if update_quantity:
            self.cart[product_id]["quantity"] = quantity
        else:
            self.cart[product_id]["quantity"] += quantity
        self.save()

    def save(self):
        self.session[settings.CART_SESSION_ID] = self.cart
        self.session.modified = True

    def remove(self, product):
        product_id = str(product.id)
        if product_id in self.cart:
            del self.cart[product_id]
            self.save()

    def __iter__(self):
        product_ids = self.cart.keys()
        products = Product.objects.filter(id__in=product_ids)
        for product in products:
            self.cart[str(product.id)]["product"] = product

        for item in self.cart.values():
            item["price"] = item["price"].split()[0].replace(",", "")
            item["total_price"] = int(item["price"]) * item["quantity"]
            yield item

    def __len__(self):
        return sum(item["quantity"] for item in self.cart.values())

    def get_total_price(self):
        return sum(
            int(item["price"].split()[0].replace(",", "")) * item["quantity"]
            for item in self.cart.values()
        )

    def clear(self):
        del self.session[settings.CART_SESSION_ID]
        self.session.modified = True

```

```## cart/models.py
from django.db import models
from products.models import Product, Image
from accounts.models import User
from django.core.validators import MaxValueValidator, MinValueValidator

# Create your models here.
class CartItem(models.Model):
    user = models.ForeignKey(User, on_delete=models.CASCADE)
    product = models.ForeignKey(Product, on_delete=models.CASCADE)
    active = models.BooleanField(default=False)
    # ìˆ˜ëŸ‰ì€ -1 ê³¼ ê°™ì€ ìˆ˜ëŸ‰ì´ ì—†ê¸° ë•Œë¬¸ì— ì•„ë˜ì˜ í•„ë“œë¡œ ì„ ì–¸í•˜ì—¬ ìµœì†Œê°’ì„ 1 ë¡œ ì„¤ì •
    quantity = models.PositiveSmallIntegerField(
        null=True, default=1, validators=[MinValueValidator(1), MaxValueValidator(100)]
    )
    created_at = models.DateTimeField(auto_now_add=True)

    class Meta:
        verbose_name = "ì¥ë°”êµ¬ë‹ˆ"
        verbose_name_plural = f"{verbose_name} ëª©ë¡"
        ordering = ["-pk"]

    def sub_total(self):
        # í…œí”Œë¦¿ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë³€ìˆ˜ë¡œ ì¥ë°”êµ¬ë‹ˆì— ë‹´ê¸´ ê° ìƒí’ˆì˜ í•©ê³„
        return self.product.price * self.quantity

    def __str__(self):
        return self.product.nam
```
```## cart/forms.py
from django import forms
# from django.utils.translation import ugettext as _

PRODUCT_QUANTITY_CHOICES = [(i, str(i)) for i in range(1, 26)]


class CartAddProductForm(forms.Form):
    # quantity = forms.TypedChoiceField(choices=PRODUCT_QUANTITY_CHOICES, coerce=int)
    quantity = forms.IntegerField(label='', initial=1, widget=forms.TextInput(attrs={'class': 'form-control rounded-0', 'style': 'background-color: rgba(255, 255, 249, 0.677);', 'type': 'number', 'min': 1, 'max':10}))
    update = forms.BooleanField(required=False, initial=False, widget=forms.HiddenInput)
```

```# cart/templates/cart/detail.html
{% extends 'base.html' %}
{% load static %}
{% load custom_tags %}
{% load i18n %}


{% block body %}
    <div class="container">
        <div class="row" style="margin-top: 6%">
        <h2 class="fs-5 fw-bolder font-space py-2 mb-5">{% trans 'ì¥ë°”êµ¬ë‹ˆ' %}</h2>
       
      
            <table class="table table-striped table-hover align-middle">
                <thead class="font-space bg-outline-dark border border-start-0 border-end-0 border-dark p-1 text-dark bg-opacity-25">
                    <tr class="text-center align-middle" style="background-color: rgba(0, 0, 0, 0.05);">
                        <th style="width: 87px;">{% trans 'ìƒí’ˆ ì´ë¯¸ì§€' %}</th>
                        <th style="width: 500px;">{% trans 'ìƒí’ˆëª…' %}</th>
                        <th>{% trans 'ìˆ˜ëŸ‰' %}</th>
                        <th style="width: 200px">{% trans 'íŒë§¤ê°€' %}</th>
                        <th style="width: 200px">{% trans 'ì£¼ë¬¸ ê¸ˆì•¡' %}</th>
                        <th style="width: 200px;">{% trans 'ì‚­ì œ' %}</th>
                    </tr>
                </thead>
                <tbody class="font-space text-decoration-none">
                {% for item in cart %}
                    {% with product=item.product %}
                        <tr class="text-end border border-0" style="background-color: rgba(255, 255, 249, 0.677) !important;">
                            {% for img in images %}
                            {% if img.product_id == product.id %}
                            <td class="text-center">
                                <a href="{% url 'products:detail' product.id %}">
                                    <img src="{{ img.product_image }}" style="height: 130px; width: 87px;"> 
                                </a>                  
                            </td>
                            {% endif %}
                            {% endfor %}
                            <td class="text-center">
                                <a href="{% url 'products:detail' product.id %}" class="text-decoration-none text-dark">
                                    {{ product.name }}
                                </a>
                            </td>
                            <td>
                                <form action="{% url "cart:cart_add" product.id %}" method="post" class="form-inline text-end">
                                    {% csrf_token %}
                                    {{ item.update_quantity_form.quantity }}
                                    {{ item.update_quantity_form.update }}
                                    <input type="submit" value="ìˆ˜ì •" class="my-1 btn btn-outline-success rounded-0 font-space"></span>
                                </form>
                            </td>
                            <td>{{ item.price|price_view }} ì›</td>
                            <td>{{ item.total_price|price_view }} ì›</td>
                            <td class="text-center">
                                <a href="{% url "cart:cart_remove" product.id %}">
                                    <button class="btn btn-none rounded-0 font-space fa-sharp fa-solid fa-trash"></button>
                                </a>
                            </td>
                        </tr>
                    {% endwith %}
                {% endfor %}
                <tr class="bg-outline-dark border border-dark border-start-0 border-end-0 p-2 text-dark bg-opacity-25">
                    <td><b>{% trans 'ì´ ê¸ˆì•¡' %}</b></td>
                    <td colspan="4"></td>
                    <td colspan="num" class="text-end"><b>{{ cart.get_total_price|price_view }} ì›</b></td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
{% endblock %}
```

## í•˜ë©´ì„œ ëŠë‚€ì 
### ì¿ í‚¤ì— ëŒ€í•œ ìƒˆë¡œìš´ ê°œë…ì„ ì•Œê²Œ ë˜ì—ˆë‹¤. ë”°ë¡œ dbì— ì €ì¥ì•ˆí•´ë„ ì¿ í‚¤ì‹œê°„ì„ ì •í•˜ë©´ ê·¸ ê¸°ë¡ë“¤ì´ ì¼ì • ì‹œê°„ ì§€ì›Œì§€ì§€ ì•ŠëŠ”ê±¸ ì•Œ ìˆ˜ ìˆì—ˆë‹¤.
### ë‹¤ìŒì—ëŠ” ì¿ í‚¤ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  dbì— ì €ì¥ë˜ê²Œ í•˜ëŠ” ê²ƒë„ í•´ë³´ê³  ì‹¶ë‹¤. ê·¸ê±¸ í•˜ë‹¤ê°€ ì˜ì•ˆë˜ì„œ ì•„ì‰½ë‹¤.